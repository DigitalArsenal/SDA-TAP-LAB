/**
 * @license
 * Cesium - https://github.com/CesiumGS/cesium
 * Version 1.111
 *
 * Copyright 2011-2022 Cesium Contributors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * Columbus View (Pat. Pend.)
 *
 * Portions licensed separately.
 * See https://github.com/CesiumGS/cesium/blob/main/LICENSE.md for full licensing details.
 */

import{a as P,b as ee}from"./chunk-ZFBLDKGW.js";import"./chunk-ROL53LLC.js";import"./chunk-C6RPXIM3.js";import{a as J}from"./chunk-PA54BVTL.js";import"./chunk-TLVCXA7M.js";import"./chunk-WWZGDXR5.js";import"./chunk-4P77FRM5.js";import"./chunk-G7FEP2WW.js";import"./chunk-SVTRHYGS.js";import"./chunk-IWSOF7XY.js";import"./chunk-XEQPSA2F.js";import"./chunk-GBTWXPEH.js";import{b as $}from"./chunk-LNQJOB2G.js";import"./chunk-AUOFUFUP.js";import{c as K}from"./chunk-PTNIWY5H.js";import"./chunk-LAL3IUCV.js";import"./chunk-CG3JQAX7.js";import{a as q}from"./chunk-VSVNBI3J.js";import"./chunk-K36PKEJW.js";import"./chunk-YOLMPEQR.js";import{c as ae,d as fe}from"./chunk-DQETLSQS.js";var re=ae((le,j)=>{/* Copyright 2015-2018 Esri. Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0 @preserve */(function(){var b=function(){var A={};A.defaultNoDataValue=-34027999387901484e22,A.decode=function(r,a){a=a||{};var n=a.encodedMaskData||a.encodedMaskData===null,i=t(r,a.inputOffset||0,n),l=a.noDataValue!==null?a.noDataValue:A.defaultNoDataValue,f=T(i,a.pixelType||Float32Array,a.encodedMaskData,l,a.returnMask),h={width:i.width,height:i.height,pixelData:f.resultPixels,minValue:f.minValue,maxValue:i.pixels.maxValue,noDataValue:l};return f.resultMask&&(h.maskData=f.resultMask),a.returnEncodedMask&&i.mask&&(h.encodedMaskData=i.mask.bitset?i.mask.bitset:null),a.returnFileInfo&&(h.fileInfo=X(i),a.computeUsedBitDepths&&(h.fileInfo.bitDepths=Z(i))),h};var T=function(r,a,n,i,l){var f=0,h=r.pixels.numBlocksX,m=r.pixels.numBlocksY,u=Math.floor(r.width/h),s=Math.floor(r.height/m),v=2*r.maxZError,o=Number.MAX_VALUE,c;n=n||(r.mask?r.mask.bitset:null);var g,x;g=new a(r.width*r.height),l&&n&&(x=new Uint8Array(r.width*r.height));for(var D=new Float32Array(u*s),M,k,V=0;V<=m;V++){var d=V!==m?s:r.height%m;if(d!==0)for(var w=0;w<=h;w++){var I=w!==h?u:r.width%h;if(I!==0){var U=V*r.width*s+w*u,y=r.width-I,p=r.pixels.blocks[f],S,B,L;p.encoding<2?(p.encoding===0?S=p.rawData:(e(p.stuffedData,p.bitsPerPixel,p.numValidPixels,p.offset,v,D,r.pixels.maxValue),S=D),B=0):p.encoding===2?L=0:L=p.offset;var O;if(n)for(k=0;k<d;k++){for(U&7&&(O=n[U>>3],O<<=U&7),M=0;M<I;M++)U&7||(O=n[U>>3]),O&128?(x&&(x[U]=1),c=p.encoding<2?S[B++]:L,o=o>c?c:o,g[U++]=c):(x&&(x[U]=0),g[U++]=i),O<<=1;U+=y}else if(p.encoding<2)for(k=0;k<d;k++){for(M=0;M<I;M++)c=S[B++],o=o>c?c:o,g[U++]=c;U+=y}else for(o=o>L?L:o,k=0;k<d;k++){for(M=0;M<I;M++)g[U++]=L;U+=y}if(p.encoding===1&&B!==p.numValidPixels)throw"Block and Mask do not match";f++}}}return{resultPixels:g,resultMask:x,minValue:o}},X=function(r){return{fileIdentifierString:r.fileIdentifierString,fileVersion:r.fileVersion,imageType:r.imageType,height:r.height,width:r.width,maxZError:r.maxZError,eofOffset:r.eofOffset,mask:r.mask?{numBlocksX:r.mask.numBlocksX,numBlocksY:r.mask.numBlocksY,numBytes:r.mask.numBytes,maxValue:r.mask.maxValue}:null,pixels:{numBlocksX:r.pixels.numBlocksX,numBlocksY:r.pixels.numBlocksY,numBytes:r.pixels.numBytes,maxValue:r.pixels.maxValue,noDataValue:r.noDataValue}}},Z=function(r){for(var a=r.pixels.numBlocksX*r.pixels.numBlocksY,n={},i=0;i<a;i++){var l=r.pixels.blocks[i];l.encoding===0?n.float32=!0:l.encoding===1?n[l.bitsPerPixel]=!0:n[0]=!0}return Object.keys(n)},t=function(r,a,n){var i={},l=new Uint8Array(r,a,10);if(i.fileIdentifierString=String.fromCharCode.apply(null,l),i.fileIdentifierString.trim()!=="CntZImage")throw"Unexpected file identifier string: "+i.fileIdentifierString;a+=10;var f=new DataView(r,a,24);if(i.fileVersion=f.getInt32(0,!0),i.imageType=f.getInt32(4,!0),i.height=f.getUint32(8,!0),i.width=f.getUint32(12,!0),i.maxZError=f.getFloat64(16,!0),a+=24,!n)if(f=new DataView(r,a,16),i.mask={},i.mask.numBlocksY=f.getUint32(0,!0),i.mask.numBlocksX=f.getUint32(4,!0),i.mask.numBytes=f.getUint32(8,!0),i.mask.maxValue=f.getFloat32(12,!0),a+=16,i.mask.numBytes>0){var h=new Uint8Array(Math.ceil(i.width*i.height/8));f=new DataView(r,a,i.mask.numBytes);var m=f.getInt16(0,!0),u=2,s=0;do{if(m>0)for(;m--;)h[s++]=f.getUint8(u++);else{var v=f.getUint8(u++);for(m=-m;m--;)h[s++]=v}m=f.getInt16(u,!0),u+=2}while(u<i.mask.numBytes);if(m!==-32768||s<h.length)throw"Unexpected end of mask RLE encoding";i.mask.bitset=h,a+=i.mask.numBytes}else i.mask.numBytes|i.mask.numBlocksY|i.mask.maxValue||(i.mask.bitset=new Uint8Array(Math.ceil(i.width*i.height/8)));f=new DataView(r,a,16),i.pixels={},i.pixels.numBlocksY=f.getUint32(0,!0),i.pixels.numBlocksX=f.getUint32(4,!0),i.pixels.numBytes=f.getUint32(8,!0),i.pixels.maxValue=f.getFloat32(12,!0),a+=16;var o=i.pixels.numBlocksX,c=i.pixels.numBlocksY,g=o+(i.width%o>0?1:0),x=c+(i.height%c>0?1:0);i.pixels.blocks=new Array(g*x);for(var D=0,M=0;M<x;M++)for(var k=0;k<g;k++){var V=0,d=r.byteLength-a;f=new DataView(r,a,Math.min(10,d));var w={};i.pixels.blocks[D++]=w;var I=f.getUint8(0);if(V++,w.encoding=I&63,w.encoding>3)throw"Invalid block encoding ("+w.encoding+")";if(w.encoding===2){a++;continue}if(I!==0&&I!==2){if(I>>=6,w.offsetType=I,I===2)w.offset=f.getInt8(1),V++;else if(I===1)w.offset=f.getInt16(1,!0),V+=2;else if(I===0)w.offset=f.getFloat32(1,!0),V+=4;else throw"Invalid block offset type";if(w.encoding===1)if(I=f.getUint8(V),V++,w.bitsPerPixel=I&63,I>>=6,w.numValidPixelsType=I,I===2)w.numValidPixels=f.getUint8(V),V++;else if(I===1)w.numValidPixels=f.getUint16(V,!0),V+=2;else if(I===0)w.numValidPixels=f.getUint32(V,!0),V+=4;else throw"Invalid valid pixel count type"}if(a+=V,w.encoding!==3){var U,y;if(w.encoding===0){var p=(i.pixels.numBytes-1)/4;if(p!==Math.floor(p))throw"uncompressed block has invalid length";U=new ArrayBuffer(p*4),y=new Uint8Array(U),y.set(new Uint8Array(r,a,p*4));var S=new Float32Array(U);w.rawData=S,a+=p*4}else if(w.encoding===1){var B=Math.ceil(w.numValidPixels*w.bitsPerPixel/8),L=Math.ceil(B/4);U=new ArrayBuffer(L*4),y=new Uint8Array(U),y.set(new Uint8Array(r,a,B)),w.stuffedData=new Uint32Array(U),a+=B}}}return i.eofOffset=a,i},e=function(r,a,n,i,l,f,h){var m=(1<<a)-1,u=0,s,v=0,o,c,g=Math.ceil((h-i)/l),x=r.length*4-Math.ceil(a*n/8);for(r[r.length-1]<<=8*x,s=0;s<n;s++){if(v===0&&(c=r[u++],v=32),v>=a)o=c>>>v-a&m,v-=a;else{var D=a-v;o=(c&m)<<D&m,c=r[u++],v=32-D,o+=c>>>v}f[s]=o<g?i+o*l:h}return f};return A}(),Q=function(){"use strict";var A={unstuff:function(t,e,r,a,n,i,l,f){var h=(1<<r)-1,m=0,u,s=0,v,o,c,g,x=t.length*4-Math.ceil(r*a/8);if(t[t.length-1]<<=8*x,n)for(u=0;u<a;u++)s===0&&(o=t[m++],s=32),s>=r?(v=o>>>s-r&h,s-=r):(c=r-s,v=(o&h)<<c&h,o=t[m++],s=32-c,v+=o>>>s),e[u]=n[v];else for(g=Math.ceil((f-i)/l),u=0;u<a;u++)s===0&&(o=t[m++],s=32),s>=r?(v=o>>>s-r&h,s-=r):(c=r-s,v=(o&h)<<c&h,o=t[m++],s=32-c,v+=o>>>s),e[u]=v<g?i+v*l:f},unstuffLUT:function(t,e,r,a,n,i){var l=(1<<e)-1,f=0,h=0,m=0,u=0,s=0,v,o=[],c=t.length*4-Math.ceil(e*r/8);t[t.length-1]<<=8*c;var g=Math.ceil((i-a)/n);for(h=0;h<r;h++)u===0&&(v=t[f++],u=32),u>=e?(s=v>>>u-e&l,u-=e):(m=e-u,s=(v&l)<<m&l,v=t[f++],u=32-m,s+=v>>>u),o[h]=s<g?a+s*n:i;return o.unshift(a),o},unstuff2:function(t,e,r,a,n,i,l,f){var h=(1<<r)-1,m=0,u,s=0,v=0,o,c,g;if(n)for(u=0;u<a;u++)s===0&&(c=t[m++],s=32,v=0),s>=r?(o=c>>>v&h,s-=r,v+=r):(g=r-s,o=c>>>v&h,c=t[m++],s=32-g,o|=(c&(1<<g)-1)<<r-g,v=g),e[u]=n[o];else{var x=Math.ceil((f-i)/l);for(u=0;u<a;u++)s===0&&(c=t[m++],s=32,v=0),s>=r?(o=c>>>v&h,s-=r,v+=r):(g=r-s,o=c>>>v&h,c=t[m++],s=32-g,o|=(c&(1<<g)-1)<<r-g,v=g),e[u]=o<x?i+o*l:f}return e},unstuffLUT2:function(t,e,r,a,n,i){var l=(1<<e)-1,f=0,h=0,m=0,u=0,s=0,v=0,o,c=[],g=Math.ceil((i-a)/n);for(h=0;h<r;h++)u===0&&(o=t[f++],u=32,v=0),u>=e?(s=o>>>v&l,u-=e,v+=e):(m=e-u,s=o>>>v&l,o=t[f++],u=32-m,s|=(o&(1<<m)-1)<<e-m,v=m),c[h]=s<g?a+s*n:i;return c.unshift(a),c},originalUnstuff:function(t,e,r,a){var n=(1<<r)-1,i=0,l,f=0,h,m,u,s=t.length*4-Math.ceil(r*a/8);for(t[t.length-1]<<=8*s,l=0;l<a;l++)f===0&&(m=t[i++],f=32),f>=r?(h=m>>>f-r&n,f-=r):(u=r-f,h=(m&n)<<u&n,m=t[i++],f=32-u,h+=m>>>f),e[l]=h;return e},originalUnstuff2:function(t,e,r,a){var n=(1<<r)-1,i=0,l,f=0,h=0,m,u,s;for(l=0;l<a;l++)f===0&&(u=t[i++],f=32,h=0),f>=r?(m=u>>>h&n,f-=r,h+=r):(s=r-f,m=u>>>h&n,u=t[i++],f=32-s,m|=(u&(1<<s)-1)<<r-s,h=s),e[l]=m;return e}},T={HUFFMAN_LUT_BITS_MAX:12,computeChecksumFletcher32:function(t){for(var e=65535,r=65535,a=t.length,n=Math.floor(a/2),i=0;n;){var l=n>=359?359:n;n-=l;do e+=t[i++]<<8,r+=e+=t[i++];while(--l);e=(e&65535)+(e>>>16),r=(r&65535)+(r>>>16)}return a&1&&(r+=e+=t[i]<<8),e=(e&65535)+(e>>>16),r=(r&65535)+(r>>>16),(r<<16|e)>>>0},readHeaderInfo:function(t,e){var r=e.ptr,a=new Uint8Array(t,r,6),n={};if(n.fileIdentifierString=String.fromCharCode.apply(null,a),n.fileIdentifierString.lastIndexOf("Lerc2",0)!==0)throw"Unexpected file identifier string (expect Lerc2 ): "+n.fileIdentifierString;r+=6;var i=new DataView(t,r,8),l=i.getInt32(0,!0);n.fileVersion=l,r+=4,l>=3&&(n.checksum=i.getUint32(4,!0),r+=4),i=new DataView(t,r,12),n.height=i.getUint32(0,!0),n.width=i.getUint32(4,!0),r+=8,l>=4?(n.numDims=i.getUint32(8,!0),r+=4):n.numDims=1,i=new DataView(t,r,40),n.numValidPixel=i.getUint32(0,!0),n.microBlockSize=i.getInt32(4,!0),n.blobSize=i.getInt32(8,!0),n.imageType=i.getInt32(12,!0),n.maxZError=i.getFloat64(16,!0),n.zMin=i.getFloat64(24,!0),n.zMax=i.getFloat64(32,!0),r+=40,e.headerInfo=n,e.ptr=r;var f,h;if(l>=3&&(h=l>=4?52:48,f=this.computeChecksumFletcher32(new Uint8Array(t,r-h,n.blobSize-14)),f!==n.checksum))throw"Checksum failed.";return!0},checkMinMaxRanges:function(t,e){var r=e.headerInfo,a=this.getDataTypeArray(r.imageType),n=r.numDims*this.getDataTypeSize(r.imageType),i=this.readSubArray(t,e.ptr,a,n),l=this.readSubArray(t,e.ptr+n,a,n);e.ptr+=2*n;var f,h=!0;for(f=0;f<r.numDims;f++)if(i[f]!==l[f]){h=!1;break}return r.minValues=i,r.maxValues=l,h},readSubArray:function(t,e,r,a){var n;if(r===Uint8Array)n=new Uint8Array(t,e,a);else{var i=new ArrayBuffer(a),l=new Uint8Array(i);l.set(new Uint8Array(t,e,a)),n=new r(i)}return n},readMask:function(t,e){var r=e.ptr,a=e.headerInfo,n=a.width*a.height,i=a.numValidPixel,l=new DataView(t,r,4),f={};if(f.numBytes=l.getUint32(0,!0),r+=4,(i===0||n===i)&&f.numBytes!==0)throw"invalid mask";var h,m;if(i===0)h=new Uint8Array(Math.ceil(n/8)),f.bitset=h,m=new Uint8Array(n),e.pixels.resultMask=m,r+=f.numBytes;else if(f.numBytes>0){h=new Uint8Array(Math.ceil(n/8)),l=new DataView(t,r,f.numBytes);var u=l.getInt16(0,!0),s=2,v=0,o=0;do{if(u>0)for(;u--;)h[v++]=l.getUint8(s++);else for(o=l.getUint8(s++),u=-u;u--;)h[v++]=o;u=l.getInt16(s,!0),s+=2}while(s<f.numBytes);if(u!==-32768||v<h.length)throw"Unexpected end of mask RLE encoding";m=new Uint8Array(n);var c=0,g=0;for(g=0;g<n;g++)g&7?(c=h[g>>3],c<<=g&7):c=h[g>>3],c&128&&(m[g]=1);e.pixels.resultMask=m,f.bitset=h,r+=f.numBytes}return e.ptr=r,e.mask=f,!0},readDataOneSweep:function(t,e,r){var a=e.ptr,n=e.headerInfo,i=n.numDims,l=n.width*n.height,f=n.imageType,h=n.numValidPixel*T.getDataTypeSize(f)*i,m,u=e.pixels.resultMask;if(r===Uint8Array)m=new Uint8Array(t,a,h);else{var s=new ArrayBuffer(h),v=new Uint8Array(s);v.set(new Uint8Array(t,a,h)),m=new r(s)}if(m.length===l*i)e.pixels.resultPixels=m;else{e.pixels.resultPixels=new r(l*i);var o=0,c=0,g=0,x=0;if(i>1)for(g=0;g<i;g++)for(x=g*l,c=0;c<l;c++)u[c]&&(e.pixels.resultPixels[x+c]=m[o++]);else for(c=0;c<l;c++)u[c]&&(e.pixels.resultPixels[c]=m[o++])}return a+=h,e.ptr=a,!0},readHuffmanTree:function(t,e){var r=this.HUFFMAN_LUT_BITS_MAX,a=new DataView(t,e.ptr,16);e.ptr+=16;var n=a.getInt32(0,!0);if(n<2)throw"unsupported Huffman version";var i=a.getInt32(4,!0),l=a.getInt32(8,!0),f=a.getInt32(12,!0);if(l>=f)return!1;var h=new Uint32Array(f-l);T.decodeBits(t,e,h);var m=[],u,s,v,o;for(u=l;u<f;u++)s=u-(u<i?0:i),m[s]={first:h[u-l],second:null};var c=t.byteLength-e.ptr,g=Math.ceil(c/4),x=new ArrayBuffer(g*4),D=new Uint8Array(x);D.set(new Uint8Array(t,e.ptr,c));var M=new Uint32Array(x),k=0,V,d=0;for(V=M[0],u=l;u<f;u++)s=u-(u<i?0:i),o=m[s].first,o>0&&(m[s].second=V<<k>>>32-o,32-k>=o?(k+=o,k===32&&(k=0,d++,V=M[d])):(k+=o-32,d++,V=M[d],m[s].second|=V>>>32-k));var w=0,I=0,U=new X;for(u=0;u<m.length;u++)m[u]!==void 0&&(w=Math.max(w,m[u].first));w>=r?I=r:I=w,w>=30&&console.log("WARning, large NUM LUT BITS IS "+w);var y=[],p,S,B,L,O,F;for(u=l;u<f;u++)if(s=u-(u<i?0:i),o=m[s].first,o>0)if(p=[o,s],o<=I)for(S=m[s].second<<I-o,B=1<<I-o,v=0;v<B;v++)y[S|v]=p;else for(S=m[s].second,F=U,L=o-1;L>=0;L--)O=S>>>L&1,O?(F.right||(F.right=new X),F=F.right):(F.left||(F.left=new X),F=F.left),L===0&&!F.val&&(F.val=p[1]);return{decodeLut:y,numBitsLUTQick:I,numBitsLUT:w,tree:U,stuffedData:M,srcPtr:d,bitPos:k}},readHuffman:function(t,e,r){var a=e.headerInfo,n=a.numDims,i=e.headerInfo.height,l=e.headerInfo.width,f=l*i,h=this.readHuffmanTree(t,e),m=h.decodeLut,u=h.tree,s=h.stuffedData,v=h.srcPtr,o=h.bitPos,c=h.numBitsLUTQick,g=h.numBitsLUT,x=e.headerInfo.imageType===0?128:0,D,M,k,V=e.pixels.resultMask,d,w,I,U,y,p,S,B=0;o>0&&(v++,o=0);var L=s[v],O=e.encodeMode===1,F=new r(f*n),E=F,Y;for(Y=0;Y<a.numDims;Y++){if(n>1&&(E=new r(F.buffer,f*Y,f),B=0),e.headerInfo.numValidPixel===l*i)for(p=0,U=0;U<i;U++)for(y=0;y<l;y++,p++){if(M=0,d=L<<o>>>32-c,w=d,32-o<c&&(d|=s[v+1]>>>64-o-c,w=d),m[w])M=m[w][1],o+=m[w][0];else for(d=L<<o>>>32-g,w=d,32-o<g&&(d|=s[v+1]>>>64-o-g,w=d),D=u,S=0;S<g;S++)if(I=d>>>g-S-1&1,D=I?D.right:D.left,!(D.left||D.right)){M=D.val,o=o+S+1;break}o>=32&&(o-=32,v++,L=s[v]),k=M-x,O?(y>0?k+=B:U>0?k+=E[p-l]:k+=B,k&=255,E[p]=k,B=k):E[p]=k}else for(p=0,U=0;U<i;U++)for(y=0;y<l;y++,p++)if(V[p]){if(M=0,d=L<<o>>>32-c,w=d,32-o<c&&(d|=s[v+1]>>>64-o-c,w=d),m[w])M=m[w][1],o+=m[w][0];else for(d=L<<o>>>32-g,w=d,32-o<g&&(d|=s[v+1]>>>64-o-g,w=d),D=u,S=0;S<g;S++)if(I=d>>>g-S-1&1,D=I?D.right:D.left,!(D.left||D.right)){M=D.val,o=o+S+1;break}o>=32&&(o-=32,v++,L=s[v]),k=M-x,O?(y>0&&V[p-1]?k+=B:U>0&&V[p-l]?k+=E[p-l]:k+=B,k&=255,E[p]=k,B=k):E[p]=k}e.ptr=e.ptr+(v+1)*4+(o>0?4:0)}e.pixels.resultPixels=F},decodeBits:function(t,e,r,a,n){{var i=e.headerInfo,l=i.fileVersion,f=0,h=new DataView(t,e.ptr,5),m=h.getUint8(0);f++;var u=m>>6,s=u===0?4:3-u,v=(m&32)>0,o=m&31,c=0;if(s===1)c=h.getUint8(f),f++;else if(s===2)c=h.getUint16(f,!0),f+=2;else if(s===4)c=h.getUint32(f,!0),f+=4;else throw"Invalid valid pixel count type";var g=2*i.maxZError,x,D,M,k,V,d,w,I,U,y,p=i.numDims>1?i.maxValues[n]:i.zMax;if(v){for(e.counter.lut++,I=h.getUint8(f),U=o,f++,k=Math.ceil((I-1)*o/8),V=Math.ceil(k/4),D=new ArrayBuffer(V*4),M=new Uint8Array(D),e.ptr+=f,M.set(new Uint8Array(t,e.ptr,k)),w=new Uint32Array(D),e.ptr+=k,y=0;I-1>>>y;)y++;k=Math.ceil(c*y/8),V=Math.ceil(k/4),D=new ArrayBuffer(V*4),M=new Uint8Array(D),M.set(new Uint8Array(t,e.ptr,k)),x=new Uint32Array(D),e.ptr+=k,l>=3?d=A.unstuffLUT2(w,o,I-1,a,g,p):d=A.unstuffLUT(w,o,I-1,a,g,p),l>=3?A.unstuff2(x,r,y,c,d):A.unstuff(x,r,y,c,d)}else e.counter.bitstuffer++,y=o,e.ptr+=f,y>0&&(k=Math.ceil(c*y/8),V=Math.ceil(k/4),D=new ArrayBuffer(V*4),M=new Uint8Array(D),M.set(new Uint8Array(t,e.ptr,k)),x=new Uint32Array(D),e.ptr+=k,l>=3?a==null?A.originalUnstuff2(x,r,y,c):A.unstuff2(x,r,y,c,!1,a,g,p):a==null?A.originalUnstuff(x,r,y,c):A.unstuff(x,r,y,c,!1,a,g,p))}},readTiles:function(t,e,r){var a=e.headerInfo,n=a.width,i=a.height,l=a.microBlockSize,f=a.imageType,h=T.getDataTypeSize(f),m=Math.ceil(n/l),u=Math.ceil(i/l);e.pixels.numBlocksY=u,e.pixels.numBlocksX=m,e.pixels.ptr=0;var s=0,v=0,o=0,c=0,g=0,x=0,D=0,M=0,k=0,V=0,d=0,w=0,I=0,U=0,y=0,p=0,S,B,L,O,F,E,Y=new r(l*l),ne=i%l||l,te=n%l||l,W,R,G=a.numDims,_,N=e.pixels.resultMask,z=e.pixels.resultPixels;for(o=0;o<u;o++)for(g=o!==u-1?l:ne,c=0;c<m;c++)for(x=c!==m-1?l:te,d=o*n*l+c*l,w=n-x,_=0;_<G;_++){if(G>1&&(z=new r(e.pixels.resultPixels.buffer,n*i*_*h,n*i)),D=t.byteLength-e.ptr,S=new DataView(t,e.ptr,Math.min(10,D)),B={},p=0,M=S.getUint8(0),p++,k=M>>6&255,V=M>>2&15,V!==(c*l>>3&15))throw"integrity issue";if(E=M&3,E>3)throw e.ptr+=p,"Invalid block encoding ("+E+")";if(E===2){e.counter.constant++,e.ptr+=p;continue}else if(E===0){if(e.counter.uncompressed++,e.ptr+=p,I=g*x*h,U=t.byteLength-e.ptr,I=I<U?I:U,L=new ArrayBuffer(I%h===0?I:I+h-I%h),O=new Uint8Array(L),O.set(new Uint8Array(t,e.ptr,I)),F=new r(L),y=0,N)for(s=0;s<g;s++){for(v=0;v<x;v++)N[d]&&(z[d]=F[y++]),d++;d+=w}else for(s=0;s<g;s++){for(v=0;v<x;v++)z[d++]=F[y++];d+=w}e.ptr+=y*h}else if(W=T.getDataTypeUsed(f,k),R=T.getOnePixel(B,p,W,S),p+=T.getDataTypeSize(W),E===3)if(e.ptr+=p,e.counter.constantoffset++,N)for(s=0;s<g;s++){for(v=0;v<x;v++)N[d]&&(z[d]=R),d++;d+=w}else for(s=0;s<g;s++){for(v=0;v<x;v++)z[d++]=R;d+=w}else if(e.ptr+=p,T.decodeBits(t,e,Y,R,_),p=0,N)for(s=0;s<g;s++){for(v=0;v<x;v++)N[d]&&(z[d]=Y[p++]),d++;d+=w}else for(s=0;s<g;s++){for(v=0;v<x;v++)z[d++]=Y[p++];d+=w}}},formatFileInfo:function(t){return{fileIdentifierString:t.headerInfo.fileIdentifierString,fileVersion:t.headerInfo.fileVersion,imageType:t.headerInfo.imageType,height:t.headerInfo.height,width:t.headerInfo.width,numValidPixel:t.headerInfo.numValidPixel,microBlockSize:t.headerInfo.microBlockSize,blobSize:t.headerInfo.blobSize,maxZError:t.headerInfo.maxZError,pixelType:T.getPixelType(t.headerInfo.imageType),eofOffset:t.eofOffset,mask:t.mask?{numBytes:t.mask.numBytes}:null,pixels:{numBlocksX:t.pixels.numBlocksX,numBlocksY:t.pixels.numBlocksY,maxValue:t.headerInfo.zMax,minValue:t.headerInfo.zMin,noDataValue:t.noDataValue}}},constructConstantSurface:function(t){var e=t.headerInfo.zMax,r=t.headerInfo.numDims,a=t.headerInfo.height*t.headerInfo.width,n=a*r,i=0,l=0,f=0,h=t.pixels.resultMask;if(h)if(r>1)for(i=0;i<r;i++)for(f=i*a,l=0;l<a;l++)h[l]&&(t.pixels.resultPixels[f+l]=e);else for(l=0;l<a;l++)h[l]&&(t.pixels.resultPixels[l]=e);else if(t.pixels.resultPixels.fill)t.pixels.resultPixels.fill(e);else for(l=0;l<n;l++)t.pixels.resultPixels[l]=e},getDataTypeArray:function(t){var e;switch(t){case 0:e=Int8Array;break;case 1:e=Uint8Array;break;case 2:e=Int16Array;break;case 3:e=Uint16Array;break;case 4:e=Int32Array;break;case 5:e=Uint32Array;break;case 6:e=Float32Array;break;case 7:e=Float64Array;break;default:e=Float32Array}return e},getPixelType:function(t){var e;switch(t){case 0:e="S8";break;case 1:e="U8";break;case 2:e="S16";break;case 3:e="U16";break;case 4:e="S32";break;case 5:e="U32";break;case 6:e="F32";break;case 7:e="F64";break;default:e="F32"}return e},isValidPixelValue:function(t,e){if(e==null)return!1;var r;switch(t){case 0:r=e>=-128&&e<=127;break;case 1:r=e>=0&&e<=255;break;case 2:r=e>=-32768&&e<=32767;break;case 3:r=e>=0&&e<=65536;break;case 4:r=e>=-2147483648&&e<=2147483647;break;case 5:r=e>=0&&e<=4294967296;break;case 6:r=e>=-34027999387901484e22&&e<=34027999387901484e22;break;case 7:r=e>=5e-324&&e<=17976931348623157e292;break;default:r=!1}return r},getDataTypeSize:function(t){var e=0;switch(t){case 0:case 1:e=1;break;case 2:case 3:e=2;break;case 4:case 5:case 6:e=4;break;case 7:e=8;break;default:e=t}return e},getDataTypeUsed:function(t,e){var r=t;switch(t){case 2:case 4:r=t-e;break;case 3:case 5:r=t-2*e;break;case 6:e===0?r=t:e===1?r=2:r=1;break;case 7:e===0?r=t:r=t-2*e+1;break;default:r=t;break}return r},getOnePixel:function(t,e,r,a){var n=0;switch(r){case 0:n=a.getInt8(e);break;case 1:n=a.getUint8(e);break;case 2:n=a.getInt16(e,!0);break;case 3:n=a.getUint16(e,!0);break;case 4:n=a.getInt32(e,!0);break;case 5:n=a.getUInt32(e,!0);break;case 6:n=a.getFloat32(e,!0);break;case 7:n=a.getFloat64(e,!0);break;default:throw"the decoder does not understand this pixel type"}return n}},X=function(t,e,r){this.val=t,this.left=e,this.right=r},Z={decode:function(t,e){e=e||{};var r=e.noDataValue,a=0,n={};if(n.ptr=e.inputOffset||0,n.pixels={},!!T.readHeaderInfo(t,n)){var i=n.headerInfo,l=i.fileVersion,f=T.getDataTypeArray(i.imageType);T.readMask(t,n),i.numValidPixel!==i.width*i.height&&!n.pixels.resultMask&&(n.pixels.resultMask=e.maskData);var h=i.width*i.height;if(n.pixels.resultPixels=new f(h*i.numDims),n.counter={onesweep:0,uncompressed:0,lut:0,bitstuffer:0,constant:0,constantoffset:0},i.numValidPixel!==0)if(i.zMax===i.zMin)T.constructConstantSurface(n);else if(l>=4&&T.checkMinMaxRanges(t,n))T.constructConstantSurface(n);else{var m=new DataView(t,n.ptr,2),u=m.getUint8(0);if(n.ptr++,u)T.readDataOneSweep(t,n,f);else if(l>1&&i.imageType<=1&&Math.abs(i.maxZError-.5)<1e-5){var s=m.getUint8(1);if(n.ptr++,n.encodeMode=s,s>2||l<4&&s>1)throw"Invalid Huffman flag "+s;s?T.readHuffman(t,n,f):T.readTiles(t,n,f)}else T.readTiles(t,n,f)}n.eofOffset=n.ptr;var v;e.inputOffset?(v=n.headerInfo.blobSize+e.inputOffset-n.ptr,Math.abs(v)>=1&&(n.eofOffset=e.inputOffset+n.headerInfo.blobSize)):(v=n.headerInfo.blobSize-n.ptr,Math.abs(v)>=1&&(n.eofOffset=n.headerInfo.blobSize));var o={width:i.width,height:i.height,pixelData:n.pixels.resultPixels,minValue:i.zMin,maxValue:i.zMax,validPixelCount:i.numValidPixel,dimCount:i.numDims,dimStats:{minValues:i.minValues,maxValues:i.maxValues},maskData:n.pixels.resultMask};if(n.pixels.resultMask&&T.isValidPixelValue(i.imageType,r)){var c=n.pixels.resultMask;for(a=0;a<h;a++)c[a]||(o.pixelData[a]=r);o.noDataValue=r}return n.noDataValue=r,e.returnFileInfo&&(o.fileInfo=T.formatFileInfo(n)),o}},getBandCount:function(t){var e=0,r=0,a={};for(a.ptr=0,a.pixels={};r<t.byteLength-58;)T.readHeaderInfo(t,a),r+=a.headerInfo.blobSize,e++,a.ptr=r;return e}};return Z}(),C=function(){var A=new ArrayBuffer(4),T=new Uint8Array(A),X=new Uint32Array(A);return X[0]=1,T[0]===1}(),H={decode:function(A,T){if(!C)throw"Big endian system is not supported.";T=T||{};var X=T.inputOffset||0,Z=new Uint8Array(A,X,10),t=String.fromCharCode.apply(null,Z),e,r;if(t.trim()==="CntZImage")e=b,r=1;else if(t.substring(0,5)==="Lerc2")e=Q,r=2;else throw"Unexpected file identifier string: "+t;for(var a=0,n=A.byteLength-10,i,l=[],f,h,m={width:0,height:0,pixels:[],pixelType:T.pixelType,mask:null,statistics:[]};X<n;){var u=e.decode(A,{inputOffset:X,encodedMaskData:i,maskData:h,returnMask:a===0,returnEncodedMask:a===0,returnFileInfo:!0,pixelType:T.pixelType||null,noDataValue:T.noDataValue||null});X=u.fileInfo.eofOffset,a===0&&(i=u.encodedMaskData,h=u.maskData,m.width=u.width,m.height=u.height,m.dimCount=u.dimCount||1,m.pixelType=u.pixelType||u.fileInfo.pixelType,m.mask=u.maskData),r>1&&u.fileInfo.mask&&u.fileInfo.mask.numBytes>0&&l.push(u.maskData),a++,m.pixels.push(u.pixelData),m.statistics.push({minValue:u.minValue,maxValue:u.maxValue,noDataValue:u.noDataValue,dimStats:u.dimStats})}var s,v,o;if(r>1&&l.length>1){for(o=m.width*m.height,m.bandMasks=l,h=new Uint8Array(o),h.set(l[0]),s=1;s<l.length;s++)for(f=l[s],v=0;v<o;v++)h[v]=h[v]&f[v];m.maskData=h}return m}};typeof define=="function"&&define.amd?define([],function(){return H}):typeof j<"u"&&j.exports?j.exports=H:this.Lerc=H})()});var ie=fe(re(),1);function se(b,Q){if(b.encoding===P.LERC){let A;try{A=ie.default.decode(b.heightmap)}catch(X){throw new q(X)}if(A.statistics[0].minValue===Number.MAX_VALUE)throw new q("Invalid tile data");b.heightmap=A.pixels[0],b.width=A.width,b.height=A.height}b.ellipsoid=K.clone(b.ellipsoid),b.rectangle=$.clone(b.rectangle);let C=ee.computeVertices(b),H=C.vertices;return Q.push(H.buffer),{vertices:H.buffer,numberOfAttributes:C.encoding.stride,minimumHeight:C.minimumHeight,maximumHeight:C.maximumHeight,gridWidth:b.width,gridHeight:b.height,boundingSphere3D:C.boundingSphere3D,orientedBoundingBox:C.orientedBoundingBox,occludeePointInScaledSpace:C.occludeePointInScaledSpace,encoding:C.encoding,westIndicesSouthToNorth:C.westIndicesSouthToNorth,southIndicesEastToWest:C.southIndicesEastToWest,eastIndicesNorthToSouth:C.eastIndicesNorthToSouth,northIndicesWestToEast:C.northIndicesWestToEast}}var ge=J(se);export{ge as default};
