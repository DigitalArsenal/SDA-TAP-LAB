/**
 * @license
 * Cesium - https://github.com/CesiumGS/cesium
 * Version 1.111
 *
 * Copyright 2011-2022 Cesium Contributors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * Columbus View (Pat. Pend.)
 *
 * Portions licensed separately.
 * See https://github.com/CesiumGS/cesium/blob/main/LICENSE.md for full licensing details.
 */

import{a as H}from"./chunk-R2WMLF5Q.js";import{a as rt}from"./chunk-3RMM272C.js";import{a as M}from"./chunk-6FTJPHAD.js";import{a as X}from"./chunk-TB7E5LLZ.js";import{a as z}from"./chunk-FE5EIIIR.js";import{a as U}from"./chunk-JQVYWZSJ.js";import{a as st}from"./chunk-74YKVVJT.js";import{b as it}from"./chunk-3FWPHNAB.js";import{a as nt}from"./chunk-IWSOF7XY.js";import{a as ot}from"./chunk-BWY4CO7K.js";import{a as ct}from"./chunk-3UAKIC5Y.js";import{a as J,c as Z,d as V}from"./chunk-43H44XVI.js";import{q as K}from"./chunk-SN4TUFKS.js";import{a as A}from"./chunk-LNQJOB2G.js";import{a as k}from"./chunk-AUOFUFUP.js";import{a as x,b as q,c as et,d as F}from"./chunk-PTNIWY5H.js";import{a as I}from"./chunk-LAL3IUCV.js";import{a as tt}from"./chunk-K36PKEJW.js";import{f as w}from"./chunk-DQETLSQS.js";function R(){this._array=[],this._offset=0,this._length=0}Object.defineProperties(R.prototype,{length:{get:function(){return this._length}}});R.prototype.enqueue=function(o){this._array.push(o),this._length++};R.prototype.dequeue=function(){if(this._length===0)return;let o=this._array,i=this._offset,u=o[i];return o[i]=void 0,i++,i>10&&i*2>o.length&&(this._array=o.slice(i),i=0),this._offset=i,this._length--,u};R.prototype.peek=function(){if(this._length!==0)return this._array[this._offset]};R.prototype.contains=function(o){return this._array.indexOf(o)!==-1};R.prototype.clear=function(){this._array.length=this._offset=this._length=0};R.prototype.sort=function(o){this._offset>0&&(this._array=this._array.slice(this._offset),this._offset=0),this._array.sort(o)};var $=R;var b={};b.computeHierarchyPackedLength=function(o,i){let u=0,c=[o];for(;c.length>0;){let r=c.pop();if(!w(r))continue;u+=2;let a=r.positions,t=r.holes;if(w(a)&&a.length>0&&(u+=a.length*i.packedLength),w(t)){let n=t.length;for(let e=0;e<n;++e)c.push(t[e])}}return u};b.packPolygonHierarchy=function(o,i,u,c){let r=[o];for(;r.length>0;){let a=r.pop();if(!w(a))continue;let t=a.positions,n=a.holes;if(i[u++]=w(t)?t.length:0,i[u++]=w(n)?n.length:0,w(t)){let e=t.length;for(let s=0;s<e;++s,u+=c.packedLength)c.pack(t[s],i,u)}if(w(n)){let e=n.length;for(let s=0;s<e;++s)r.push(n[s])}}return u};b.unpackPolygonHierarchy=function(o,i,u){let c=o[i++],r=o[i++],a=new Array(c),t=r>0?new Array(r):void 0;for(let n=0;n<c;++n,i+=u.packedLength)a[n]=u.unpack(o,i);for(let n=0;n<r;++n)t[n]=b.unpackPolygonHierarchy(o,i,u),i=t[n].startingIndex,delete t[n].startingIndex;return{positions:a,holes:t,startingIndex:i}};var O=new A;function ht(o,i,u,c){return A.subtract(i,o,O),A.multiplyByScalar(O,u/c,O),A.add(o,O,O),[O.x,O.y]}var G=new x;function gt(o,i,u,c){return x.subtract(i,o,G),x.multiplyByScalar(G,u/c,G),x.add(o,G,G),[G.x,G.y,G.z]}b.subdivideLineCount=function(o,i,u){let r=x.distance(o,i)/u,a=Math.max(0,Math.ceil(I.log2(r)));return Math.pow(2,a)};var j=new q,Q=new q,dt=new q,pt=new x,Y=new U;b.subdivideRhumbLineCount=function(o,i,u,c){let r=o.cartesianToCartographic(i,j),a=o.cartesianToCartographic(u,Q),n=new U(r,a,o).surfaceDistance/c,e=Math.max(0,Math.ceil(I.log2(n)));return Math.pow(2,e)};b.subdivideTexcoordLine=function(o,i,u,c,r,a){let t=b.subdivideLineCount(u,c,r),n=A.distance(o,i),e=n/t,s=a;s.length=t*2;let l=0;for(let h=0;h<t;h++){let f=ht(o,i,h*e,n);s[l++]=f[0],s[l++]=f[1]}return s};b.subdivideLine=function(o,i,u,c){let r=b.subdivideLineCount(o,i,u),a=x.distance(o,i),t=a/r;w(c)||(c=[]);let n=c;n.length=r*3;let e=0;for(let s=0;s<r;s++){let l=gt(o,i,s*t,a);n[e++]=l[0],n[e++]=l[1],n[e++]=l[2]}return n};b.subdivideTexcoordRhumbLine=function(o,i,u,c,r,a,t){let n=u.cartesianToCartographic(c,j),e=u.cartesianToCartographic(r,Q);Y.setEndPoints(n,e);let s=Y.surfaceDistance/a,l=Math.max(0,Math.ceil(I.log2(s))),h=Math.pow(2,l),f=A.distance(o,i),d=f/h,m=t;m.length=h*2;let p=0;for(let g=0;g<h;g++){let y=ht(o,i,g*d,f);m[p++]=y[0],m[p++]=y[1]}return m};b.subdivideRhumbLine=function(o,i,u,c,r){let a=o.cartesianToCartographic(i,j),t=o.cartesianToCartographic(u,Q),n=new U(a,t,o),e=n.surfaceDistance/c,s=Math.max(0,Math.ceil(I.log2(e))),l=Math.pow(2,s),h=n.surfaceDistance/l;w(r)||(r=[]);let f=r;f.length=l*3;let d=0;for(let m=0;m<l;m++){let p=n.interpolateUsingSurfaceDistance(m*h,dt),g=o.cartographicToCartesian(p,pt);f[d++]=g.x,f[d++]=g.y,f[d++]=g.z}return f};var mt=new x,yt=new x,wt=new x,xt=new x;b.scaleToGeodeticHeightExtruded=function(o,i,u,c,r){c=tt(c,et.WGS84);let a=mt,t=yt,n=wt,e=xt;if(w(o)&&w(o.attributes)&&w(o.attributes.position)){let s=o.attributes.position.values,l=s.length/2;for(let h=0;h<l;h+=3)x.fromArray(s,h,n),c.geodeticSurfaceNormal(n,a),e=c.scaleToGeodeticSurface(n,e),t=x.multiplyByScalar(a,u,t),t=x.add(e,t,t),s[h+l]=t.x,s[h+1+l]=t.y,s[h+2+l]=t.z,r&&(e=x.clone(n,e)),t=x.multiplyByScalar(a,i,t),t=x.add(e,t,t),s[h]=t.x,s[h+1]=t.y,s[h+2]=t.z}return o};b.polygonOutlinesFromHierarchy=function(o,i,u){let c=[],r=new $;r.enqueue(o);let a,t,n;for(;r.length!==0;){let e=r.dequeue(),s=e.positions;if(i)for(n=s.length,a=0;a<n;a++)u.scaleToGeodeticSurface(s[a],s[a]);if(s=z(s,x.equalsEpsilon,!0),s.length<3)continue;let l=e.holes?e.holes.length:0;for(a=0;a<l;a++){let h=e.holes[a],f=h.positions;if(i)for(n=f.length,t=0;t<n;++t)u.scaleToGeodeticSurface(f[t],f[t]);if(f=z(f,x.equalsEpsilon,!0),f.length<3)continue;c.push(f);let d=0;for(w(h.holes)&&(d=h.holes.length),t=0;t<d;t++)r.enqueue(h.holes[t])}c.push(s)}return c};var bt=new q;function Lt(o,i,u){let c=u.cartesianToCartographic(o,j),r=u.cartesianToCartographic(i,Q);if(Math.sign(c.latitude)===Math.sign(r.latitude))return;Y.setEndPoints(c,r);let a=Y.findIntersectionWithLatitude(0,bt);if(!w(a))return;let t=Math.min(c.longitude,r.longitude),n=Math.max(c.longitude,r.longitude);if(Math.abs(n-t)>I.PI){let e=t;t=n,n=e}if(!(a.longitude<t||a.longitude>n))return u.cartographicToCartesian(a)}function Tt(o,i,u,c){if(c===M.RHUMB)return Lt(o,i,u);let r=it.lineSegmentPlane(o,i,nt.ORIGIN_XY_PLANE);if(w(r))return u.scaleToGeodeticSurface(r,r)}var Et=new q;function vt(o,i,u){let c=[],r,a,t,n,e,s=0;for(;s<o.length;){r=o[s],a=o[(s+1)%o.length],t=I.sign(r.z),n=I.sign(a.z);let l=h=>i.cartesianToCartographic(h,Et).longitude;if(t===0)c.push({position:s,type:t,visited:!1,next:n,theta:l(r)});else if(n!==0){if(e=Tt(r,a,i,u),++s,!w(e))continue;o.splice(s,0,e),c.push({position:s,type:t,visited:!1,next:n,theta:l(e)})}++s}return c}function lt(o,i,u,c,r,a,t){let n=[],e=a,s=h=>f=>f.position===h,l=[];do{let h=u[e];n.push(h);let f=c.findIndex(s(e)),d=c[f];if(!w(d)){++e;continue}let{visited:m,type:p,next:g}=d;if(d.visited=!0,p===0){if(g===0){let C=c[f-(t?1:-1)];if(C?.position===e+1)C.visited=!0;else{++e;continue}}if(!m&&t&&g>0||a===e&&!t&&g<0){++e;continue}}if(!(t?p>=0:p<=0)){++e;continue}m||l.push(e);let L=f+(t?1:-1),S=c[L];if(!w(S)){++e;continue}e=S.position}while(e<u.length&&e>=0&&e!==a&&n.length<u.length);o.splice(i,r,n);for(let h of l)i=lt(o,++i,u,c,0,h,!t);return i}b.splitPolygonsOnEquator=function(o,i,u,c){w(c)||(c=[]),c.splice(0,0,...o),c.length=o.length;let r=0;for(;r<c.length;){let a=c[r],t=a.slice();if(a.length<3){c[r]=t,++r;continue}let n=vt(t,i,u);if(t.length===a.length||n.length<=1){c[r]=t,++r;continue}n.sort((s,l)=>s.theta-l.theta);let e=t[0].z>=0;r=lt(c,r,t,n,1,0,e)}return c};b.polygonsFromHierarchy=function(o,i,u,c,r,a){let t=[],n=[],e=new $;e.enqueue(o);let s=w(a);for(;e.length!==0;){let l=e.dequeue(),h=l.positions,f=l.holes,d,m;if(c)for(m=h.length,d=0;d<m;d++)r.scaleToGeodeticSurface(h[d],h[d]);if(i||(h=z(h,x.equalsEpsilon,!0)),h.length<3)continue;let p=u(h);if(!w(p))continue;let g=[],y=H.computeWindingOrder2D(p);if(y===X.CLOCKWISE&&(p.reverse(),h=h.slice().reverse()),s){s=!1;let P=[h];if(P=a(P,P),P.length>1){for(let v of P)e.enqueue(new rt(v,f));continue}}let L=h.slice(),S=w(f)?f.length:0,C=[],T;for(d=0;d<S;d++){let P=f[d],v=P.positions;if(c)for(m=v.length,T=0;T<m;++T)r.scaleToGeodeticSurface(v[T],v[T]);if(i||(v=z(v,x.equalsEpsilon,!0)),v.length<3)continue;let E=u(v);if(!w(E))continue;y=H.computeWindingOrder2D(E),y===X.CLOCKWISE&&(E.reverse(),v=v.slice().reverse()),C.push(v),g.push(L.length),L=L.concat(v),p=p.concat(E);let D=0;for(w(P.holes)&&(D=P.holes.length),T=0;T<D;T++)e.enqueue(P.holes[T])}t.push({outerRing:h,holes:C}),n.push({positions:L,positions2D:p,holes:g})}return{hierarchy:t,polygons:n}};var Ct=new A,Pt=new x,Dt=new K,It=new F;b.computeBoundingRectangle=function(o,i,u,c,r){let a=K.fromAxisAngle(o,c,Dt),t=F.fromQuaternion(a,It),n=Number.POSITIVE_INFINITY,e=Number.NEGATIVE_INFINITY,s=Number.POSITIVE_INFINITY,l=Number.NEGATIVE_INFINITY,h=u.length;for(let f=0;f<h;++f){let d=x.clone(u[f],Pt);F.multiplyByVector(t,d,d);let m=i(d,Ct);w(m)&&(n=Math.min(n,m.x),e=Math.max(e,m.x),s=Math.min(s,m.y),l=Math.max(l,m.y))}return r.x=n,r.y=s,r.width=e-n,r.height=l-s,r};b.createGeometryFromPositions=function(o,i,u,c,r,a,t){let n=H.triangulate(i.positions2D,i.holes);n.length<3&&(n=[0,1,2]);let e=i.positions,s=w(u),l=s?u.positions:void 0;if(r){let h=e.length,f=new Array(h*3),d=0;for(let g=0;g<h;g++){let y=e[g];f[d++]=y.x,f[d++]=y.y,f[d++]=y.z}let m={attributes:{position:new V({componentDatatype:k.DOUBLE,componentsPerAttribute:3,values:f})},indices:n,primitiveType:J.TRIANGLES};s&&(m.attributes.st=new V({componentDatatype:k.FLOAT,componentsPerAttribute:2,values:A.packArray(l)}));let p=new Z(m);return a.normal?st.computeNormal(p):p}if(t===M.GEODESIC)return H.computeSubdivision(o,e,n,l,c);if(t===M.RHUMB)return H.computeRhumbLineSubdivision(o,e,n,l,c)};var ut=[],at=[],St=new x,_t=new x;b.computeWallGeometry=function(o,i,u,c,r,a){let t,n,e,s,l,h,f,d,m,p=o.length,g=0,y=0,L=w(i),S=L?i.positions:void 0;if(r)for(n=p*3*2,t=new Array(n*2),L&&(m=p*2*2,d=new Array(m*2)),e=0;e<p;e++)s=o[e],l=o[(e+1)%p],t[g]=t[g+n]=s.x,++g,t[g]=t[g+n]=s.y,++g,t[g]=t[g+n]=s.z,++g,t[g]=t[g+n]=l.x,++g,t[g]=t[g+n]=l.y,++g,t[g]=t[g+n]=l.z,++g,L&&(h=S[e],f=S[(e+1)%p],d[y]=d[y+m]=h.x,++y,d[y]=d[y+m]=h.y,++y,d[y]=d[y+m]=f.x,++y,d[y]=d[y+m]=f.y,++y);else{let E=I.chordLength(c,u.maximumRadius),D=0;if(a===M.GEODESIC)for(e=0;e<p;e++)D+=b.subdivideLineCount(o[e],o[(e+1)%p],E);else if(a===M.RHUMB)for(e=0;e<p;e++)D+=b.subdivideRhumbLineCount(u,o[e],o[(e+1)%p],E);for(n=(D+p)*3,t=new Array(n*2),L&&(m=(D+p)*2,d=new Array(m*2)),e=0;e<p;e++){s=o[e],l=o[(e+1)%p];let _,N;L&&(h=S[e],f=S[(e+1)%p]),a===M.GEODESIC?(_=b.subdivideLine(s,l,E,at),L&&(N=b.subdivideTexcoordLine(h,f,s,l,E,ut))):a===M.RHUMB&&(_=b.subdivideRhumbLine(u,s,l,E,at),L&&(N=b.subdivideTexcoordRhumbLine(h,f,u,s,l,E,ut)));let ft=_.length;for(let B=0;B<ft;++B,++g)t[g]=_[B],t[g+n]=_[B];if(t[g]=l.x,t[g+n]=l.x,++g,t[g]=l.y,t[g+n]=l.y,++g,t[g]=l.z,t[g+n]=l.z,++g,L){let B=N.length;for(let W=0;W<B;++W,++y)d[y]=N[W],d[y+m]=N[W];d[y]=f.x,d[y+m]=f.x,++y,d[y]=f.y,d[y+m]=f.y,++y}}}p=t.length;let C=ot.createTypedArray(p/3,p-o.length*6),T=0;for(p/=6,e=0;e<p;e++){let E=e,D=E+1,_=E+p,N=_+1;s=x.fromArray(t,E*3,St),l=x.fromArray(t,D*3,_t),!x.equalsEpsilon(s,l,I.EPSILON10,I.EPSILON10)&&(C[T++]=E,C[T++]=_,C[T++]=D,C[T++]=D,C[T++]=_,C[T++]=N)}let P={attributes:new ct({position:new V({componentDatatype:k.DOUBLE,componentsPerAttribute:3,values:t})}),indices:C,primitiveType:J.TRIANGLES};return L&&(P.attributes.st=new V({componentDatatype:k.FLOAT,componentsPerAttribute:2,values:d})),new Z(P)};var oe=b;export{oe as a};
